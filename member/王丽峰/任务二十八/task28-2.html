<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>task28-2</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link href="" rel="stylesheet">
<script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/1.9.1/jquery.min.js"></script>
<style>
	#header .container{
		height:50px;
		background:red;
	}
	.container{
		width:900px;
		margin:0 auto;
	}
	.nav{
		height:30px;
		border:1px solid;
		background:yellow;
	}
	.wrap{
		margin-top:20px;
	}
	.aside{
		float:left;
		width:200px;
		height:400px;
		background:pink;
	}
	.aside2{
		background:yellow;
	}
	.aside3{
		background:red;
	}
	.aside4{
		background:pink;
	}
	.main{
		float:right;
		width:680px;
		height:400px;
		background: blue;
	}
	.clearfix:after{
		content:'';
		display:block;
		clear:both;
	}
</style>
</head>
<body>
    <div id="header">
   		<div class="container">header</div>
    </div>
	<div id="content">
		<div class="container">
			<div class="wrap clearfix">
				<div class="nav">nav1</div>
				<div class="aside aside1">aside1</div>
				<div class="main">main1</div>
			</div>
			<div class="wrap clearfix">
				<div class="nav">nav2</div>
				<div class="aside aside2">aside2</div>
				<div class="main">main2</div>
			</div>
			<div class="wrap clearfix">
				<div class="nav">nav3</div>
				<div class="aside aside3">aside3</div>
				<div class="main">main3</div>
			</div>
			<div class="wrap clearfix">
				<div class="nav">nav4</div>
				<div class="aside aside4">aside4</div>
				<div class="main">main4</div>
			</div>
		</div>
	</div>
	<script>
	 $('.nav').each(function(){
	 	   var $nav=$(this),
	 	   navHeight=$nav.height(),
           navWidht=$nav.width(),
           offsetTop=$nav.offset().top,//获取匹配元素相对于当前视口上方的位移
           offsetLeft=$nav.offset().left;//获取匹配元素相对于当前视口左方的位移
        var $navClone=$nav.clone().css({visibility:'hidden',display:'none'}).insertBefore($nav);

        $(window).on('scroll',function(){
        	var scrollTop=$(this).scrollTop();//获取匹配元素相对滚动条顶部的偏移

        	if(scrollTop>=offsetTop){
        		if(!isFixed()){
        			setFixed();
        		}
        	}else{
        		if(isFixed()){
        			unsetFixed();
        		}
        	}
        });

        function isFixed(){
        	return $nav.data('data-fixed');
        }
        function setFixed(){
        	$nav.data('data-fixed',true)
        	    .css({'position':'fixed',
        	    	  'top':0,
        	    	  'left':offsetLeft,
        	    	  'width':navWidht,
        	    	  'margin':0,
        	    	  'z-index':9999
        		});
        	$navClone.show();
        }
        function unsetFixed(){
        	$nav.data('data-fixed',false)
        		.removeAttr('style');
        	$navClone.hide();
        }

	 })
	</script>
</body>
</html>