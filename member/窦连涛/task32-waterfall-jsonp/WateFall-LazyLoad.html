<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>瀑布流+JSONP+无限加载</title>
	<style>
		html,body,ul,li,div,p {
			margin: 0;
			padding: 0;
		}

		ul,li {
			list-style: none;
		}

		.clearfix:after {
			content:'';
			display: block;
			clear:both;
		}

		.clearfix {
			*zoom:1;
		}

		.ct {
			position: relative;
			padding: 10px;
			margin:0 auto;
		}

		.ct .item {
			width:200px;
			position: absolute;
			padding: 0 0 10px 0 ;
			border:1px solid #DFDFDF;
			background: #FFF;
			margin:10px;
			transition: all .8s;
			box-shadow: 2px 2px 2px #E8E8E8,-2px -2px 2px #E8E8E8;
		}

		.ct .item img {
			width:176px;
			margin: 12px;
		}

		.ct img .header {
			height: 25px;
			margin:0 12px;
			border-bottom: 1px solid #DBDBDB;
		}

		.ct .desp {
			font-size: 12px;
			line-height: 1.8;
			margin:10px 15px 0;
			color: #777371;
		}

		#load {
			
		}

		.hide {
			visibility: hidden;
		}

	</style>
</head>
<body>
	<div class="ct-waterfall">
		<ul id="pic-ct" class="ct clearfix">
			<!-- <li class="item">
				<a href="#" class="link">
					<img src="" alt="">
				</a>
				<h4 class="header"></h4>
				<p class="desp"></p>
			</li> -->
		</ul>
		<div id="load" class="hide">我是看不见的</div>
	</div>
	<script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript" src="Exposure.js"></script>
	<script type="text/javascript" src="WaterFall.js"></script>
	<script type="text/javascript">
		//懒加载
		//Ajax
		//瀑布流
		
		var $page = 1,
			$amount = 10;

		WaterFall.init($('.pic-ct'));

		Exposure.init($('#load'),function(){
			getdata(function(data){
				$nodes = render(data);
				$WaterFall.start($nodes);
			})
		})

		function getdata(callback){
			$.ajax({
					url: 'http://platform.sina.com.cn/slide/album_tech?',
					type: 'get',
					dataType: 'jsonp',
					jsonp:'jsoncallback',
					data: {
						app_key: '1271687855',
						format:'json',
						size:'img',
						num:perPageCount,
						page:curPage
					},
					success: function(ret){
						if(ret.status.code === "0"){
							callback(ret.data);
							curPage++;
						}
					}
				})			
		}

		function render($items){
			var $tpl = '',
				$nodes;
			for (var i =0; i < $items.length; i++) {
				$tpl += '<li class="item">';
				$tpl += '<a href="#" class="link">';
				$tpl += '<img src="'+ $items[i].img_url +'" alt=""></a>';
				$tpl += '<h4 class="header">'+ $items[i].short_name +'</h4>';
				$tpl += '<p class="desp">'+ $items[i].short_intro +'</p></li>';
			}

			$nodes = $(tpl);
			$('#pic-ct').append($nodes);
			return $nodes;
		}
	</script>
</body>
</html>