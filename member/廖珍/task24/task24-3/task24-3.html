<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>注册</title>
		<style type="text/css"></style>
	</head>
	<style>
	   #register {
	   	height:320px;
	    width:600px;
	    position:absolute;
	    top:50%;
	    left:50%;
	    margin-left:-300px;
	    margin-top:-160px;
	    border:1px solid #ccc;
	    background:#00A2FF;
	   }
	   .register-ct {
	   	padding:0px 115px;
	   }
	   #register h3 {
	   	padding:0px 115px;
	   }
	   .register-ct dd {
	     margin-left:85px;
	     padding:5px 0px;
	     font-size: 12px;
	     color:#ccc;
	   }
	   .register-ct dt {
	     float:left;
	     width:80px;
	     height:30px;
	     line-height:30px;
	   }
	   .register-ct input {
	   	  height:24px;
	   	  line-height:24px;
	   	  border:1px solid #ccc;
	   	  border-radius: 3px
	   }
	   .btn {
	   	text-decoration:none;
	   	padding:6px;
	   	display:inline-block;
	    margin-left:85px;
	    margin-top:10px;
	    border:1px solid #ccc;
	    border-radius: 3px;
	    color:hsla(33, 83%, 46%, 0.85);
	    background:#4D2EAD;
	    font-size:14px;
	   }
	</style>
	<body>
		<div id="register">
			<h3>注册</h3>
			<from id="register-form" action="">
				<dl class="register-ct">
					<dt>用户名</dt>
					<dd>
						<input id="username"type="text" placeholder="用户名(hunger被注册过)">
					</dd>
					<dd class="msg msg-un">只能是字母、数字、下划线、3-10个字符</dd>
					<dt>密码</dt>
					  <dd>
					  	<input id="password1" type="password" name="password">
					  </dd>
					  <dd class="msg msg-pwd1">
					  	大写字母、小写、数字、下划线最少两种，6-15个字符
					  </dd>
					  <dt>再输一次：</dt>
					  <dd>
					  	<input id="password2" type="password" placeholder="再输入一次密码">
					  </dd>
					 <dd class="msg msg-pwd2">大写字母、小写、数字、下划线最少两种，6-15个字符</dd>
					  <a class="btn" href="#">注册</a>

					

				</dl>
				
			</from>
		</div>
	</body>
	<script src="ajax.js"></script>
	<script src="class.js"></script>
	<script src="until_valid.js"></script>
	<script>
		var usernameIpt=document.querySelector("#username"),
		    pwdIpt1=document.querySelector("#password1"),
		    pwdIpt2=document.querySelector("#password2"),
		    btn=document.querySelector(".btn"),
		    unMsg=document.getElementsByClassName("msg-un")[0],
		    pswMsg1=document.getElementsByClassName("msg-pwd1")[0],
		    pswMsg2=document.getElementsByClassName("msg-pwd2")[0];
		usernameIpt.addEventListener("change",function() {
			testUn()&&testUnUseage();
		});
		pwdIpt1.addEventListener("change",function() {
			testPwd1();
		});
		pwdIpt2.addEventListener("change",function() {
			testPwd2();
		});
		btn.addEventListener('click',function(e){
	      e.preventDefault();
	      if(testUn() && testPwd1() && testPwd2()){
	      	 testUnUseage(function(validName){ 
	             if(validName){
	             	alert('正在注册.....');
	             	console.log('正在注册....');
	             }
	      	 })
	      }
	});

		function testUnUseage(handle) {
			ajax({
				url:"task24-4.php",
				type:"post",
				data:{
					userName:usernameIpt.value
				},
				success:function(ret) {
					if(!ret.data) {
						unMsg.innerText="用户名已存在";
						addClass(usernameIpt,"error");
						handle&&handle(false);
					}else if(ret.data) {
						unMsg.innerText="";
						removeClass(usernameIpt,"error");
						handle&&handle(true);
					}
				}
			})
		}
		function testUn() {
			var userName=usernameIpt.value;
			if(!regName(userName)) {
				unMsg.innerText="请输入正确的格式";
				addClass(usernameIpt,"error");
				return false;
			}else{
				unMsg.innerText=" ";
				removeClass(usernameIpt,"error");
				return true;
			}
		}
		function testPwd1() {
			var pwd1=pwdIpt1.value;
			if(!regPassword(pwd1)) {
				pswMsg1.innerText="请输入正确格式";
				addClass(pwdIpt1,"error");
				return false;
			}else{
				pswMsg1.innerText=" ";
				removeClass(pwdIpt1,"error");
				return true;
			}
		}
		function testPwd2() {
			var pwd2=pwdIpt2.value;
			if(!regPassword(pwd2)) {
				pswMsg2.innerText="请输入正确格式";
				addClass(pwdIpt2,"error");
				return false;
			}else if(pwd2!== pwdIpt1.value) {
				pswMsg2.innerText="密码不一致";
				addClass(pwdIpt2,"error");
				return false;

			}else {
				pswMsg2.innerText="";
				removeClass(pwdIpt2,"error");
				return true;
			}
		}
	</script>
</html>